local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

-- Tạo ScreenGui và Button
local player = Players.LocalPlayer
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ChestTPGui"
screenGui.Parent = player.PlayerGui

local button = Instance.new("TextButton")
button.Name = "TPButton"
button.Text = "TP To Chests"
button.Size = UDim2.new(0, 150, 0, 50)
button.Position = UDim2.new(0.8, 0, 0.1, 0)
button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 18
button.Parent = screenGui

-- Function để lấy tất cả các chest
local function getAllChests()
    local chests = {}
    local maps = workspace:FindFirstChild("Maps")
    
    if maps then
        for _, map in pairs(maps:GetChildren()) do
            local chestsFolder = map:FindFirstChild("Chests")
            if chestsFolder then
                for _, chest in pairs(chestsFolder:GetDescendants()) do
                    if chest:IsA("BasePart") and string.find(chest.Name:lower(), "chest") then
                        table.insert(chests, chest)
                    end
                end
            end
        end
    end
    
    return chests
end

-- Biến để theo dõi trạng thái
local isTPRunning = false
local currentChestIndex = 1
local chests = {}

-- Function để teleport
local function teleportToChest(chest)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local humanoidRootPart = player.Character.HumanoidRootPart
        humanoidRootPart.CFrame = chest.CFrame + Vector3.new(0, 3, 0)
    end
end

-- Function để dừng teleport
local function stopTeleporting()
    isTPRunning = false
    currentChestIndex = 1
end

-- Function để bắt đầu teleport
local function startTeleporting()
    if isTPRunning then
        stopTeleporting()
        button.Text = "TP To Chests"
        button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        return
    end

    chests = getAllChests()
    if #chests == 0 then
        button.Text = "No Chests Found!"
        wait(1)
        button.Text = "TP To Chests"
        return
    end

    isTPRunning = true
    button.Text = "Stop TP"
    button.BackgroundColor3 = Color3.fromRGB(0, 255, 0)

    -- Coroutine để teleport
    spawn(function()
        while isTPRunning do
            if currentChestIndex > #chests then
                currentChestIndex = 1
            end
            
            teleportToChest(chests[currentChestIndex])
            currentChestIndex = currentChestIndex + 1
            wait(0.1) -- Đợi 0.1 giây giữa mỗi lần teleport
        end
    end)
end

-- Kết nối button với function
button.MouseButton1Click:Connect(startTeleporting)

-- Cleanup khi script bị hủy
screenGui.Destroying:Connect(function()
    stopTeleporting()
end)
